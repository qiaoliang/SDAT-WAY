# SDAT Method: 核心架构

## 1. 概述

SDAT Method旨在提供代理模式、任务和模板，以允许可重复的有用工作流程，无论是用于敏捷代理开发，还是扩展到完全不同的领域。项目的核心目的是提供结构化但灵活的提示、模板和工作流程集，用户可以使用这些来指导AI代理（如Gemini、Claude或ChatGPT）以可预测、高质量的方式执行复杂任务、指导讨论或其他有意义的特定领域流程。

系统的核心模块促进了一个完整的开发生命周期，专门针对当前现代AI代理工具的挑战：

1. **构思和规划**：头脑风暴、市场研究和创建项目简报。
2. **架构和设计**：定义系统架构和UI/UX规范。
3. **开发执行**：一个循环工作流程，其中SM代理起草具有极其具体上下文的故事，开发人员（Dev）代理一次实现一个。这个过程适用于新项目（绿地）和现有项目（棕地）。

## 2. 系统架构图

整个SDAT-Method生态系统围绕安装的`sdat-core`目录设计，该目录作为操作的大脑。`tools`目录提供了处理和打包这个大脑以适应不同环境的方法。

```"sdat-core"
            A -->"agents"
            A -->"agent-teams"
            A -->"workflows"
            A -->"templates"
            A -->"tasks"
            A -->"checklists"
            A -->"KB""tools/builders/web-builder.js""dist"
        end

        B -- defines dependencies for --> E
        B -- defines dependencies for --> F
        B -- defines dependencies for --> G
        B -- defines dependencies for --> H

        C -- bundles --> B
        I -- reads from --> A
        I -- creates -->"Cursor, VS Code, etc.""Gemini, ChatGPT"
    end

    B --> K
    J --> L

    style A fill:#1a73e8,color:#fff
    style I fill:#f9ab00,color:#fff
    style J fill:#34a853,color:#fff
```

## 3. 核心组件

`sdat-core`目录包含所有定义和资源，这些定义和资源为代理提供其能力。

### 3.1. 代理（`sdat-core/agents/`）

- **目的**：这些是系统的基础构建块。每个markdown文件（例如，`sdat-master.md`、`pm.md`、`dev.md`）定义单个AI代理的角色、能力和依赖。
- **结构**：代理文件包含一个YAML头部，指定其角色、角色、依赖和启动指令。这些依赖是代理允许使用的任务、模板、检查清单和数据文件的列表。
- **启动指令**：代理可以包含启动序列，从`docs/`文件夹加载项目特定文档，如编码标准、API规范或项目结构文档。这提供了激活时的即时项目上下文。
- **文档集成**：代理可以引用和加载项目`docs/`文件夹中的文档，作为任务、工作流程或启动序列的一部分。用户还可以直接将文档拖入聊天界面以提供额外上下文。
- **示例**：`sdat-master`代理列出其依赖，这告诉构建工具要在web包中包含哪些文件，并告知代理其自身的能力。

### 3.2. 代理团队（`sdat-core/agent-teams/`）

- **目的**：团队文件（例如，`team-all.yaml`）定义代理和工作流程的集合，这些集合被捆绑在一起用于特定目的，如"全栈开发"或"仅后端"。这为web UI环境创建了更大的预打包上下文。
- **结构**：团队文件列出要包含的代理。它可以使用通配符，如`"*"`来包含所有代理。这允许创建像`team-all`这样的综合包。

### 3.3. 工作流程（`sdat-core/workflows/`）

- **目的**：工作流程是YAML文件（例如，`greenfield-fullstack.yaml`），定义特定项目类型的规定的步骤序列和代理交互。它们作为用户和`sdat-orchestrator`代理的战略指南。
- **结构**：工作流程为复杂和简单项目定义序列，列出每个步骤涉及的代理、它们创建的工件，以及从一个步骤移动到下一个步骤的条件。它通常包括一个Mermaid图表用于可视化。

### 3.4. 可重用资源（`templates`、`tasks`、`checklists`、`data`）

- **目的**：这些文件夹包含模块化组件，这些组件根据代理的依赖关系动态加载。
    - **`templates/`**：包含常见文档的markdown模板，如PRD、架构规范和用户故事。
    - **`tasks/`**：定义执行特定、可重复操作的指令，如"shard-doc"或"create-next-story"。
    - **`checklists/`**：为产品负责人（`po`）或架构师等代理提供质量保证检查清单。
    - **`data/`**：包含核心知识库（`sdat-kb.md`）、技术偏好（`technical-preferences.md`）和其他关键数据文件。

#### 3.4.1. 模板处理系统

SDAT的一个关键架构原则是模板是自包含和交互式的 - 它们嵌入所需的文档输出和与用户工作所需的LLM指令。这意味着在许多情况下，文档创建不需要单独的任务，因为模板本身包含所有处理逻辑。

SDAT框架采用了一个由三个关键组件编排的复杂模板处理系统：

- **`template-format.md`**（`sdat-core/utils/`）：定义在所有SDAT模板中使用的标记语言。此规范建立变量替换（`{{placeholders}}`）、仅AI处理指令（`[[LLM: instructions]]`）和条件逻辑块的语法规则。模板遵循此格式以确保整个系统的一致处理。

- **`create-doc.md`**（`sdat-core/tasks/`）：作为编排引擎，管理整个文档生成工作流程。此任务协调模板选择、管理用户交互模式（增量与快速生成）、强制执行模板格式处理规则，并处理验证。它作为用户和模板系统之间的主要接口。

- **`advanced-elicitation.md`**（`sdat-core/tasks/`）：提供一个交互式优化层，可以通过`[[LLM: instructions]]`块嵌入到模板中。此组件提供10个结构化头脑风暴操作、逐节审查能力和迭代改进工作流程，以增强内容质量。

系统保持关注点的清晰分离：模板标记由AI代理内部处理但从不暴露给用户，同时通过模板本身中的嵌入式智能提供复杂的AI处理能力。

#### 3.4.2. 技术偏好系统

SDAT通过`sdat-core/data/`中的`technical-preferences.md`文件包含个性化层。此文件作为持久技术配置文件，影响所有项目中代理的行为。

**目的和好处：**

- **一致性**：确保所有代理引用相同的技术偏好
- **效率**：消除重复指定首选技术的需要
- **个性化**：代理提供与用户偏好一致的建议
- **学习**：捕获经验教训和随时间演变的偏好

**内容结构：**
文件通常包括首选技术栈、设计模式、外部服务、编码标准和要避免的反模式。代理在规划和开发期间自动引用此文件，以提供上下文适当的建议。

**集成点：**

- 模板可以在文档生成期间引用技术偏好
- 代理在适合项目要求时建议首选技术
- 当偏好不适合项目需求时，代理解释替代方案
- Web包可以包含偏好内容，以便跨平台的一致行为

**随时间演变：**
鼓励用户用项目中的发现持续更新此文件，添加积极偏好和要避免的技术，创建一个个性化的知识库，随着时间的推移改进代理建议。

## 4. 构建和交付过程

框架设计用于两个主要环境：本地IDE和基于web的AI聊天界面。`web-builder.js`脚本是支持后者的关键。

### 4.1. Web构建器（`tools/builders/web-builder.js`）

- **目的**：此Node.js脚本负责创建`dist`中找到的`.txt`包。
- **过程**：
    1. **解析依赖**：对于给定的代理或团队，脚本读取其定义文件。
    2. 它递归查找代理/团队需要的所有依赖资源（任务、模板等）。
    3. **捆绑内容**：它读取所有这些文件的内容并将它们连接成一个大的文本文件，带有清晰的分隔符指示每个部分的原始文件路径。
    4. **输出包**：最终的`.txt`文件保存在`dist`目录中，准备上传到web UI。

### 4.2. 环境特定使用

- **对于IDE**：用户通过`sdat-core/agents/`中的markdown文件直接与代理交互。IDE集成（对于Cursor、Claude Code等）知道如何调用这些代理。
- **对于Web UI**：用户从`dist`上传预构建的包。这个单一文件为AI提供整个团队和所有必需工具和知识的上下文。

## 5. SDAT工作流程

### 5.1. 规划工作流程

在开发开始之前，SDAT遵循结构化规划工作流程，为成功的项目执行建立基础：

```"开始：项目想法" --> B{"可选：分析师头脑风暴"}
    B -->|是|"分析师：市场研究和分析"
    B -->|否|"创建项目简报"
    C -->"分析师：创建项目简报"
    D -->"PM：从简报创建PRD"
    E -->"架构师：从PRD创建架构"
    F -->"PO：运行主检查清单"
    G --> H{"文档对齐？"}
    H -->|是|"规划完成"
    H -->|否|"PO：更新史诗和故事"
    J -->"根据需要更新PRD/架构"
    K --> G
    I -->"📁 切换到IDE"
    L -->"PO：分片文档"
    M -->"准备SM/Dev周期"

    style I fill:#34a853,color:#fff
    style G fill:#f9ab00,color:#fff
    style L fill:#1a73e8,color:#fff
    style N fill:#34a853,color:#fff
```

**关键规划阶段：**

1. **可选分析**：分析师进行市场研究和竞争分析
2. **项目简报**：由分析师或用户创建的基础文档
3. **PRD创建**：PM将简报转换为全面的产品需求
4. **架构设计**：架构师基于PRD创建技术基础
5. **验证和对齐**：PO确保所有文档一致且完整
6. **优化**：根据需要更新史诗、故事和文档
7. **环境转换**：从web UI到IDE的关键切换，用于开发工作流程
8. **文档准备**：PO分片大文档以供开发消费

**工作流程编排**：`sdat-orchestrator`代理使用这些工作流程定义来指导用户完成整个过程，确保规划（web UI）和开发（IDE）阶段之间的适当转换。

### 5.2. 核心开发周期

一旦初始规划和架构阶段完成，项目进入循环开发工作流程，如`sdat-kb.md`中详细说明的。这确保了稳定、顺序和质量控制的实现过程。

```"开始：规划工件完成" -->"PO：分片史诗"
    B -->"PO：分片架构"
    C -->"开发阶段"
    D -->"Scrum Master：从分片史诗起草下一个故事"
    E --> F{"用户批准"}
    F -->|批准|"Dev：实现故事"
    F -->|需要更改| E
    G -->"Dev：完成故事任务"
    H -->"Dev：标记准备审查"
    I --> J{"用户验证"}
    J -->|请求QA审查|"QA：运行review-story任务"
    J -->|无QA批准|"标记故事为完成"
    K --> L{"QA审查结果"}
    L -->|需要工作| G
    L -->|批准|"标记故事为完成"
    J -->|需要修复| G
    M --> E

    style M fill:#34a853,color:#fff
    style K fill:#f9ab00,color:#fff
```

这个周期继续，Scrum Master、开发人员和可选的QA代理一起工作。QA代理通过`review-story`任务提供高级开发人员审查能力，提供代码重构、质量改进和知识转移。这确保了高代码质量，同时保持开发速度。
