workflow:
    id: greenfield-ui
    name: Greenfield UI/Frontend Development
    description: >-
        从概念到开发构建前端应用程序的 agent 工作流。
        支持复杂 UI 的全面规划和简单界面的快速原型设计。
    type: greenfield
    project_types:
        - spa
        - mobile-app
        - micro-frontend
        - static-site
        - ui-prototype
        - simple-interface

    sequence:
        - agent: analyst
          creates: project-brief.md
          optional_steps:
              - brainstorming_session
              - market_research_prompt
          notes: "可以先进行头脑风暴，然后在创建项目简介之前进行可选的深入研究。保存输出：将最终的 project-brief.md 复制到您项目的 docs/ 文件夹中。"

        - agent: pm
          creates: prd.md
          requires: project-brief.md
          notes: "使用 prd-tmpl 从项目简介创建 PRD，专注于 UI/前端需求。保存输出：将最终的 prd.md 复制到您项目的 docs/ 文件夹中。"

        - agent: ux-expert
          creates: front-end-spec.md
          requires: prd.md
          optional_steps:
              - user_research_prompt
          notes: "使用 front-end-spec-tmpl 创建 UI/UX 规范。保存输出：将最终的 front-end-spec.md 复制到您项目的 docs/ 文件夹中。"

        - agent: ux-expert
          creates: v0_prompt (optional)
          requires: front-end-spec.md
          condition: user_wants_ai_generation
          notes: "可选但推荐：为 v0、Lovable 等工具生成 AI UI 提示。使用 generate-ai-frontend-prompt 任务。用户然后可以在外部工具中生成 UI 并下载项目结构。"

        - agent: architect
          creates: front-end-architecture.md
          requires: front-end-spec.md
          optional_steps:
              - technical_research_prompt
              - review_generated_ui_structure
          notes: "使用 front-end-architecture-tmpl 创建前端架构。如果用户使用 v0/Lovable 生成了 UI，可以将项目结构整合到架构中。可能会建议修改 PRD 故事或添加新故事。保存输出：将最终的 front-end-architecture.md 复制到您项目的 docs/ 文件夹中。"

        - agent: pm
          updates: prd.md (if needed)
          requires: front-end-architecture.md
          condition: architecture_suggests_prd_changes
          notes: "如果 architect 建议故事变更，更新 PRD 并将完整的未编辑 prd.md 重新导出到 docs/ 文件夹。"

        - agent: po
          validates: all_artifacts
          uses: po-master-checklist
          notes: "验证所有文档的一致性和完整性。可能需要更新任何文档。"

        - agent: various
          updates: any_flagged_documents
          condition: po_checklist_issues
          notes: "如果 PO 发现问题，返回到相关 agent 进行修复并将更新的文档重新导出到 docs/ 文件夹。"

        - project_setup_guidance:
          action: guide_project_structure
          condition: user_has_generated_ui
          notes: "如果用户使用 v0/Lovable 生成了 UI：对于 polyrepo 设置，将下载的项目放在单独的前端 repo 中。对于 monorepo，放在 apps/web 或 frontend/ 目录中。查看架构文档获取具体指导。"

        - agent: po
          action: shard_documents
          creates: sharded_docs
          requires: all_artifacts_in_project
          notes: |
              为 IDE 开发分片文档：
              - 选项 A：使用 PO agent 分片：@po 然后要求分片 docs/prd.md
              - 选项 B：手动：将 shard-doc 任务 + docs/prd.md 拖入聊天
              - 创建 docs/prd/ 和 docs/architecture/ 文件夹，包含分片内容

        - agent: sm
          action: create_story
          creates: story.md
          requires: sharded_docs
          repeats: for_each_epic
          notes: |
              故事创建周期：
              - SM Agent（新聊天）：@sm → *create
              - 从分片文档创建下一个故事
              - 故事以"草稿"状态开始

        - agent: analyst/pm
          action: review_draft_story
          updates: story.md
          requires: story.md
          optional: true
          condition: user_wants_story_review
          notes: |
              可选：审查并批准草稿故事
              - 注意：story-review 任务即将推出
              - 审查故事完整性和一致性
              - 更新故事状态：草稿 → 已批准

        - agent: dev
          action: implement_story
          creates: implementation_files
          requires: story.md
          notes: |
              Dev Agent（新聊天）：@dev
              - 实现已批准的故事
              - 使用所有更改更新文件列表
              - 完成时将故事标记为"审查"

        - agent: qa
          action: review_implementation
          updates: implementation_files
          requires: implementation_files
          optional: true
          notes: |
              可选：QA Agent（新聊天）：@qa → review-story
              - 具有重构能力的高级开发审查
              - 直接修复小问题
              - 为剩余项目留下检查清单
              - 更新故事状态（审查 → 完成或保持审查）

        - agent: dev
          action: address_qa_feedback
          updates: implementation_files
          condition: qa_left_unchecked_items
          notes: |
              如果 QA 留下未检查的项目：
              - Dev Agent（新聊天）：处理剩余项目
              - 返回 QA 进行最终批准

        - repeat_development_cycle:
          action: continue_for_all_stories
          notes: |
              为所有 epic 故事重复故事周期（SM → Dev → QA）
              继续直到 PRD 中的所有故事完成

        - agent: po
          action: epic_retrospective
          creates: epic-retrospective.md
          condition: epic_complete
          optional: true
          notes: |
              可选：epic 完成后
              - 注意：epic-retrospective 任务即将推出
              - 验证 epic 是否正确完成
              - 记录学习和改进

        - workflow_end:
          action: project_complete
          notes: |
              所有故事已实现并审查！
              项目开发阶段完成。

              参考：{root}/data/sdat-kb.md#IDE Development Workflow

    flow_diagram: |
        ```mermaid
        graph TD
            A[Start: UI Development] --> B[analyst: project-brief.md]
            B --> C[pm: prd.md]
            C --> D[ux-expert: front-end-spec.md]
            D --> D2{Generate v0 prompt?}
            D2 -->|Yes| D3[ux-expert: create v0 prompt]
            D2 -->|No| E[architect: front-end-architecture.md]
            D3 --> D4[User: generate UI in v0/Lovable]
            D4 --> E
            E --> F{Architecture suggests PRD changes?}
            F -->|Yes| G[pm: update prd.md]
            F -->|No| H[po: validate all artifacts]
            G --> H
            H --> I{PO finds issues?}
            I -->|Yes| J[Return to relevant agent for fixes]
            I -->|No| K[po: shard documents]
            J --> H

            K --> L[sm: create story]
            L --> M{Review draft story?}
            M -->|Yes| N[analyst/pm: review & approve story]
            M -->|No| O[dev: implement story]
            N --> O
            O --> P{QA review?}
            P -->|Yes| Q[qa: review implementation]
            P -->|No| R{More stories?}
            Q --> S{QA found issues?}
            S -->|Yes| T[dev: address QA feedback]
            S -->|No| R
            T --> Q
            R -->|Yes| L
            R -->|No| U{Epic retrospective?}
            U -->|Yes| V[po: epic retrospective]
            U -->|No| W[Project Complete]
            V --> W

            B -.-> B1[Optional: brainstorming]
            B -.-> B2[Optional: market research]
            D -.-> D1[Optional: user research]
            E -.-> E1[Optional: technical research]

            style W fill:#90EE90
            style K fill:#ADD8E6
            style L fill:#ADD8E6
            style O fill:#ADD8E6
            style D3 fill:#E6E6FA
            style D4 fill:#E6E6FA
            style B fill:#FFE4B5
            style C fill:#FFE4B5
            style D fill:#FFE4B5
            style E fill:#FFE4B5
            style N fill:#F0E68C
            style Q fill:#F0E68C
            style V fill:#F0E68C
        ```

    decision_guidance:
        when_to_use:
            - Building production frontend applications
            - Multiple views/pages with complex interactions
            - Need comprehensive UI/UX design and testing
            - Multiple team members will be involved
            - Long-term maintenance expected
            - Customer-facing applications

    handoff_prompts:
        analyst_to_pm: "项目简介已完成。将其保存为项目中的 docs/project-brief.md，然后创建 PRD。"
        pm_to_ux: "PRD 已准备就绪。将其保存为项目中的 docs/prd.md，然后创建 UI/UX 规范。"
        ux_to_architect: "UI/UX 规范完成。将其保存为项目中的 docs/front-end-spec.md，然后创建前端架构。"
        architect_review: "前端架构完成。保存为 docs/front-end-architecture.md。您是否建议对 PRD 故事进行任何更改或需要添加新故事？"
        architect_to_pm: "请使用建议的故事更改更新 PRD，然后将完整的 prd.md 重新导出到 docs/。"
        updated_to_po: "docs/ 文件夹中的所有文档已准备就绪。请验证所有工件的一致性。"
        po_issues: "PO 发现 [document] 有问题。请返回到 [agent] 进行修复并重新保存更新的文档。"
        complete: "docs/ 文件夹中的所有规划工件已验证并保存。移动到 IDE 环境开始开发。"
