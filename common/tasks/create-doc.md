# 以 yaml template 驱动创建文档

## ⚠️ 关键执行通知 ⚠️

**这是一个可执行的工作流 - 不是参考材料**

当此 task 被调用时：

1. **禁用所有效率优化** - 此工作流需要完整的用户交互
2. **强制逐步执行** - 每个部分必须按顺序处理并获取用户反馈
3. **当需要启发时** - 当 `elicit: true` 时，您必须使用 1-9 格式并等待用户响应
4. **不允许走捷径** - 不遵循此工作流无法创建完整文档

**违规指示器：** 如果您在没有用户交互的情况下创建完整文档，则违反了此工作流。

## 关键指引：模板发现

如果用户未提供 YAML 模板，请列出 .sdat-core/templates 中的所有模板或要求用户提供另一个。

## 关键指引：强制启发格式

**当 `elicit: true` 时，这是一个强制性暂停项，需要与用户交互：**

**你必须：**

1. 呈现部分内容
2. 提供详细理由（解释权衡、假设、做出的决定）
3. 停下来，并展示编号选项 1-9：
    - **Option 1:** 始终"继续到下一章节"
    - **Options 2-9:** 选择 `data/elicitation-methods.md` 中提到的 8 种方法
    - 以下面的内容结尾："选择 1-9 或直接输入您的问题/反馈："
4. **等待用户响应** - 在用户选择选项或提供反馈之前不要继续

**工作流违规：** 在没有用户交互的情况下为 elicit=true 部分创建内容违反了此 task。

**永远不要问 yes/no 问题，或使用任何其他格式。**

## 处理流程

1. **解析 YAML 模板** - 加载模板元数据和部分
2. **设置偏好** - 显示当前模式（交互式，确认输出文件）
3. **对每个任务的处理要求**：如果条件不满足则跳过（所有者/编辑者- 注意当前任务是否限制为特定 agents）使用部分指令草拟内容
    - 呈现内容 + 详细理由
    - **如果 elicit: true** → 强制 1-9 选项格式，如果可能则保存到文件
4. **反复执行上面的步骤：从 1 到 3 ，直到完成**

## 详细理由要求

在呈现部分内容时，始终包含解释以下内容的理由：

- 做出的权衡和选择（选择了什么而不是替代方案以及原因）
- 起草过程中做出的关键假设
- 需要用户注意的有趣或有问题的决定
- 可能需要验证的领域

## 用户选择启发方法（2-9）以后

1. 执行 `data/elicitation-methods.md` 中的相关方法
2. 呈现结果和见解
3. 提供选项：
    - **1. 对文档应用变更，并并更新相应的章节**
    - **2. 返回启发菜单**
    - **3. 提出任何问题或进一步参与此启发**

## Agent 权限

处理标有 agent 权限字段的部分时：

- **owner**: 注意哪个 agent 角色最初创建或填充了该部分
- **editors**: 列出允许修改该部分的 agent 角色
- **readonly**: 标记创建后无法修改的部分

**对于访问受限的部分：**在生成的文档中包含一个注释，指示负责的 agent

- 示例："\*（此部分由 dev-agent 拥有，只能由 dev-agent 修改"）

## YOLO 模式

用户可以输入 `#yolo` 切换到 YOLO 模式（一次处理所有部分。）

## 关键提醒

**❌ 永远不要：**

- 在做启发式询问时，提出 yes/no 类型的问题
- 使用除 1-9 编号选项之外的任何格式创建新的启发方法

**✅ 始终坚持：**

- 当 elicit: true 时，使用精确的 1-9 格式
- 从 `data/elicitation-methods.md` 中选择选项 2-9, 提供解释决定的详细理由
- 以"选择 1-9 或直接输入您的问题/反馈：" 结尾
